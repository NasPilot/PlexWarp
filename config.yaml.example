# PlexWarp 配置文件示例
# 专注于 Plex 302 重定向播放功能

# 基础配置
port: 3002
host: "0.0.0.0"

# Plex 服务器配置
plex_server:
  addr: "http://127.0.0.1:32400"  # Plex 服务器地址
  auth: ""                        # Plex 访问令牌（可选）

# 日志配置
logger:
  access_logger:
    console: true
    file: true
  service_logger:
    console: true
    file: true

# Plex 302 重定向配置
plex302:
  enable: true                     # 启用 302 重定向功能
  media_mount_paths:               # 媒体挂载路径列表
    - "/mnt"
    - "/media"
  transcode_enable: false          # 是否允许转码（false=强制直播）
  fallback_original: true          # 失败时是否回退到原始链接
  check_link_validity: false       # 是否检查链接有效性

# 路径映射规则
path_mapping:
  enable: true
  rules:
    # 示例：将本地路径映射到网络路径
    # - from: "/mnt/movies"
    #   to: "http://nas.local/movies"
    # - from: "/mnt/tv"
    #   to: "http://nas.local/tv"

# 软链接处理规则
symlink_rules:
  enable: true
  rules:
    # 示例：处理软链接路径
    # - path: "/mnt/symlinks"
    #   target: "/actual/path"

# STRM 文件处理规则
strm_redirect:
  enable: true
  last_link_rules:
    # 对于包含局域网 IP 的链接，通过代理转发
    - match_type: "startswith"      # 匹配类型：startswith, endswith, contains, regex
      patterns:
        - "http://192.168."
        - "http://10."
        - "http://172."
      action: "proxy"               # 动作：proxy（代理）, redirect（重定向）
    # 对于 HTTP 链接，直接重定向
    - match_type: "startswith"
      patterns:
        - "http://"
        - "https://"
      action: "redirect"

# 客户端过滤配置（可选）
client_filter:
  enable: false
  mode: "whitelist"                # whitelist 或 blacklist
  clients:
    - "Plex Web"
    - "Plex for iOS"
    - "Plex for Android"